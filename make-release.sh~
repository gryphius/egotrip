#!/bin/sh

BUILDAPK="bin/StartupActivity-release.apk"
OUTDIR="release"
mkdir -p $OUTDIR/builds

echo ""
echo "!! REMEMBER TO INCREASE Version and Disable Debuggable Flag in AndroidManifest.xml !!"
echo ""
echo "Press Enter to continue"
read a

NOW=`date +%Y-%m-%d`

#build and sign apk
ant release

#get version no
version=`aapt d badging  $BUILDAPK  | grep versionCode | awk '{print $3}' | grep -Po "(?<=')[^']+(?=')"`
echo "Version code is: $version"

#update version.txt
echo $version > $OUTDIR/updateversion.txt
cp $BUILDAPK $OUTDIR/builds/egotrip-${version}-${NOW}.apk
cp $BUILDAPK $OUTDIR/egotrip.apk -f

#beta command info
echo ""
echo "To deploy the beta:"
echo "scp release/egotrip.apk release/updateversion.txt svn.myegotrip.net:/var/www/beta/"

